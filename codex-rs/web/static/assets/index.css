:root{
  --bg:#0b0e14; --bg-soft:#0f1420; --glass:#0f1420cc;
  --fg:#e6edf3; --muted:#9aa4b2; --line:#1f2736;
  --accent:#5b9dff; --accent2:#9f5bff; --danger:#ff4d5f;
  --radius:16px; --radius-sm:10px; --shadow:0 10px 30px #00000026;
  --space:16px; --space-sm:10px; --space-lg:24px;
  --blur:10px; --fast:120ms; --slow:240ms;
  --font-base: clamp(14px, 1.1vw, 16px);
}
[data-theme="light"]{
  --bg:#ffffff; --bg-soft:#fafafa; --glass:#ffffffcc;
  --fg:#111418; --muted:#5b6270; --line:#e6e6ea;
}

*{ box-sizing:border-box }
html, body{ height:100% }
body{
  margin:0; color:var(--fg); background:var(--bg);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  font-size: var(--font-base);
  line-height: 1.45;
}

.app-header{
  position:sticky; top:0; z-index:10;
  display:grid; grid-template-columns: auto 1fr auto auto; gap:12px;
  align-items:center; padding:12px 16px;
  backdrop-filter: blur(var(--blur));
  background:linear-gradient(180deg, var(--glass), transparent);
  border-bottom:1px solid var(--line);
  transition: transform var(--fast) ease;
}
/* Auto-hide support */
.app-header.header-hidden{ transform: translateY(-110%) }
.brand .home{ display:flex; align-items:center; gap:6px; color:var(--fg); text-decoration:none; padding:4px 8px; border-radius:8px; border:1px solid var(--line); background:var(--bg-soft) }
.brand .logo{ font-weight:700; font-size:14px }
/* Minimal brand: hide wordmark by default for a cleaner header */
.brand .name{ display:none }
.nav{ display:flex; gap:8px }
.nav-link{ color:var(--fg); text-decoration:none; padding:6px 10px; border-radius:10px; border:1px solid var(--line); background:var(--bg-soft) }
.status{ display:flex; gap:8px; align-items:center; justify-self:center; flex-wrap: wrap }
.actions{ display:flex; gap:8px; align-items:center }
.controls{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
.controls .field{ flex:0 0 auto }
.controls select, .controls input[type=text]{ min-width: 140px }

.container{ max-width:1200px; margin:0 auto; padding:20px }
.grid{ display:grid; grid-template-columns: 7fr 5fr; gap:16px; align-items:start }
.col{ display:flex; flex-direction:column; gap:16px }

.card{
  border:1px solid var(--line); border-radius:var(--radius);
  padding:18px; background:var(--glass); box-shadow:var(--shadow);
  transition: border-color var(--fast) ease, box-shadow var(--fast) ease, transform var(--fast) ease;
}
.card:hover{ border-color:#2a3550; box-shadow:0 12px 34px #00000030; transform: translateY(-1px) }
.card-head{ display:flex; align-items:center; justify-content:space-between; gap:12px }
.filters{ display:flex; gap:8px; align-items:center }

.field-row{ display:flex; gap:12px; flex-wrap:wrap }
.field{ flex:1 1 260px }
label{ display:block; font-size:12px; margin:8px 0 4px; color:var(--muted) }
input[type=text], select, .filter, .palette-input{
  width:100%; padding:10px 12px; border:1px solid var(--line);
  border-radius:var(--radius-sm); background:var(--bg-soft); color:var(--fg);
}
/* Consistent textarea styling */
textarea{
  width:100%; padding:10px 12px; border:1px solid var(--line);
  border-radius:var(--radius-sm); background:var(--bg-soft); color:var(--fg);
  resize: vertical;
}
/* Focus styles for inputs/selects/textareas */
input[type=text]:focus, select:focus, textarea:focus, .palette-input:focus{
  outline:2px solid var(--accent); outline-offset:2px; border-color: var(--accent);
}
/* Hover affordance */
input[type=text]:hover, select:hover, textarea:hover, .palette-input:hover{
  border-color:#2a3550; background:rgba(255,255,255,0.02);
}
/* Placeholder color */
input::placeholder, textarea::placeholder{ color:var(--muted); opacity:0.8 }
/* Disabled */
input:disabled, select:disabled, textarea:disabled{ opacity:0.7; cursor:not-allowed }
.presets{ display:flex; gap:8px; margin-top:8px; flex-wrap:wrap }
.chip{ padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:transparent; color:var(--fg); cursor:pointer }

.btn{ padding:10px 14px; border-radius:12px; border:1px solid var(--line); cursor:pointer; color:#fff; background:linear-gradient(135deg, var(--accent), var(--accent2)); transition: transform var(--fast) ease }
.btn:hover{ transform: translateY(-1px) }
.btn:active{ transform: translateY(0) scale(0.99) }
.btn:disabled{ opacity:0.6; cursor:not-allowed }
.btn.ghost{ background:transparent; color:var(--fg) }
.btn.primary{ background:linear-gradient(135deg, var(--accent), var(--accent2)); color:#fff }
.btn-row{ display:flex; gap:8px; flex-wrap:wrap }
.right{ display:flex; justify-content:flex-end; margin-top:8px }

.list{ border-top:1px solid var(--line); margin-top:8px }
.rowi{ display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid var(--line) }
.muted{ color:var(--muted) }
.mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace }

.pill{ padding:3px 8px; border-radius:999px; border:1px solid var(--line); font-size:12px }
.pill-ok{ background:#1a2a1f; color:#9be7a0; border-color:#24422a }
.pill-warn{ background:#2a1f1f; color:#ffb3b8; border-color:#3c2a2a }
.pill-info{ background:#182233; color:#a6c8ff; border-color:#26334a }
.pill-muted{ background:transparent; color:var(--muted) }

.app-footer{ padding:12px 16px; border-top:1px solid var(--line); color:var(--muted); text-align:center }

.modal{ position:fixed; inset:0; display:none; align-items:flex-start; justify-content:center; padding:10vh 16px; background:#00000066; backdrop-filter: blur(3px) }
.modal[aria-hidden="false"]{ display:flex }
.modal-card{ width:min(800px, 100%); background:var(--bg-soft); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden }
.palette-input{ border:0; border-bottom:1px solid var(--line); border-top-left-radius:var(--radius); border-top-right-radius:var(--radius) }
.palette-list{ max-height:50vh; overflow:auto }
.cmd-row{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 12px; border-bottom:1px solid var(--line) }
.cmd-row:hover{ background:rgba(255,255,255,0.03) }
.cmd-left{ display:flex; flex-direction:column }
.cmd-title{ font-weight:600 }
.cmd-sub{ font-size:12px; color:var(--muted) }

/* Approval modals */
.approval-card{ padding:12px }
.approval-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; border-bottom:1px solid var(--line); padding-bottom:8px }
.approval-body{ display:grid; grid-template-columns: 1fr 2fr; gap:12px; max-height:50vh; overflow:auto; padding:10px 0 }
.approval-actions{ display:flex; gap:8px; justify-content:flex-end; border-top:1px solid var(--line); padding-top:8px }
.file-list{ border:1px solid var(--line); border-radius:10px; overflow:auto }
.file-item{ padding:6px 8px; border-bottom:1px solid var(--line); cursor:pointer; display:flex; justify-content:space-between; gap:8px }
.file-item.active{ background:rgba(255,255,255,0.05) }
.diff{ border:1px solid var(--line); border-radius:10px; overflow:auto; background:#080b10 }
.diff pre{ margin:0; padding:10px; white-space:pre; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace }

/* Focus & a11y */
:focus{ outline:2px solid transparent }
:focus-visible{ outline:2px solid var(--accent); outline-offset:2px }

/* Responsive */
@media (max-width: 900px){
  .grid{ grid-template-columns: 1fr }
}

/* Compact header mode: shrink top bar height and content density */
@media (max-height: 420px), (max-width: 820px){
  .app-header{ padding:6px 12px; grid-template-columns: auto 1fr auto; gap:8px; }
  .brand .home{ padding:4px 8px; gap:6px; border-radius:8px }
  .brand .logo{ font-size:14px }
  .brand .name{ display:none }
  .status{ gap:6px; flex-wrap:nowrap; overflow:hidden }
  .pill{ font-size:11px; padding:2px 6px }
  /* Hide less critical pills to prevent wrap */
  #approval-pill, #sandbox-pill, #cwd-pill{ display:none }
  .actions .btn{ padding:6px 8px }
}

/* Motion */
@media (prefers-reduced-motion: reduce){
  .btn{ transition:none }
}

/* Session page helpers */
.grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px }
/* Allow grid children to shrink so long content doesnâ€™t overflow */
.grid > *, .grid2 > *{ min-width:0 }
.feed{ border:1px solid var(--line); border-radius:16px; padding:12px; background:var(--glass); max-height:60vh; overflow:auto }
.turn{ padding:10px 10px; border-bottom:1px solid var(--line) }
.msg{ padding:6px 6px }
.msg-head{ display:flex; align-items:center; gap:8px; color:var(--muted); font-size:12px; margin-bottom:4px }
.msg-user .msg-head .who{ color:#a6c8ff }
.msg-assistant .msg-head .who{ color:#9be7a0 }
.msg-system .msg-head .who{ color:#ffb3b8 }
.copy-btn{ border:1px solid var(--line); background:transparent; color:var(--fg); border-radius:8px; padding:2px 6px; font-size:11px; cursor:pointer }
.md{ overflow-wrap:anywhere; word-break:break-word }
.md p{ margin: 6px 0 }
.md code{ background: rgba(255,255,255,0.06); padding:0 4px; border-radius:6px }
.md pre{ background:#080b10; border:1px solid var(--line); border-radius:10px; padding:10px; overflow:auto }
.md ul{ margin:6px 0 6px 18px }
.reasoning{ border:1px dashed var(--line); border-radius:10px; padding:8px; margin:8px 0; background:rgba(255,255,255,0.03) }
.reasoning.collapsed .body{ display:none }
.reasoning .head{ display:flex; align-items:center; justify-content:space-between; gap:8px; color:var(--muted); font-size:12px }
.toggle-btn{ border:1px solid var(--line); background:transparent; color:var(--fg); border-radius:8px; padding:2px 6px; font-size:11px; cursor:pointer }
.new-indicator{ position:sticky; bottom:8px; display:none; justify-content:center }
.new-indicator .btn{ background:var(--bg-soft); color:var(--fg) }

/* Plan */
.plan{ display:flex; flex-direction:column; gap:6px }
.plan-item{ display:flex; align-items:center; gap:8px; padding:6px 8px; border:1px solid var(--line); border-radius:8px; background:rgba(255,255,255,0.02) }
.plan-step{ flex:1 }
.badge{ font-size:11px; padding:2px 6px; border-radius:999px; border:1px solid var(--line) }
.b-pending{ background:#2a2a1f; color:#f0e68c; border-color:#3a3a2a }
.b-inprogress{ background:#1f2a2a; color:#98f5e1; border-color:#2a3a3a }
.b-completed{ background:#1a2a1f; color:#9be7a0; border-color:#24422a }

/* Sticky composer on mobile */
.composer{ position:relative }
@media (max-width: 900px){
  .grid{ grid-template-columns: 1fr }
  .container{ padding:12px }
  .app-header{ grid-template-columns: auto 1fr auto; }
  .composer{ position:sticky; bottom:0; z-index:5; background:var(--glass); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); padding-bottom:8px }
}
@media (max-width: 700px){
  .pill{ font-size:11px }
  .btn{ padding:9px 12px }
}
@media (max-width: 480px){
  .actions .btn{ padding:8px 10px }
}

/* Scrollbar styling for WebKit browsers */
.feed::-webkit-scrollbar, .diff::-webkit-scrollbar, .palette-list::-webkit-scrollbar { width:10px; height:10px }
.feed::-webkit-scrollbar-thumb, .diff::-webkit-scrollbar-thumb, .palette-list::-webkit-scrollbar-thumb { background:#31405e; border-radius:10px }
.feed::-webkit-scrollbar-track, .diff::-webkit-scrollbar-track, .palette-list::-webkit-scrollbar-track { background:transparent }

/* Utilities */
.hidden{ display:none !important }
.msg:last-child{ border-bottom:0 }
.meta{ font-size:12px; color:var(--muted) }
pre{ margin:6px 0 0; white-space:pre-wrap; word-break:break-word }
/* Media should never exceed container width */
img, video, canvas, svg{ max-width:100%; height:auto }

/* Queue styles */
.queue{ border:1px solid var(--line); border-radius:10px; padding:8px; margin-top:10px; background:rgba(255,255,255,0.02) }
.queue-head{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:6px }
.queue-title{ font-weight:600; font-size:12px; color:var(--muted) }
.queue-list{ display:flex; flex-direction:column; gap:6px }
.queue-item{ display:flex; align-items:center; gap:8px; border:1px solid var(--line); border-radius:8px; padding:6px; background:rgba(255,255,255,0.02) }
.queue-text{ flex:1; min-width:0; font-size:12px; color:var(--fg); white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
.queue-actions{ display:flex; align-items:center; gap:6px }
.queue-actions .btn-sm{ padding:4px 6px; font-size:11px; border-radius:6px; border:1px solid var(--line); background:transparent; color:var(--fg); cursor:pointer }
.queue-actions .btn-sm:hover{ background:rgba(255,255,255,0.04) }
